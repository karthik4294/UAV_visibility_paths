clc;clear all;

rotate3d;
R = input('Enter the point on the road: '); 
radius = sqrt(1000^2 - 700^2);center = R + [0,0,700];
normal = [0,0,1];
theta=0:0.0001:2*pi;
v=null(normal);
points=repmat(center',1,size(theta,2))+radius*(v(:,1)*cos(theta)+v(:,2)*sin(theta));
%plot3(points(1,:),points(2,:),points(3,:),'r-');
fill3(points(1,:), points(2,:), points(3,:), 'g')
hold on
axis([-1500 1500 -1500 1500 0 1000]);
axis('square');

a = [380,375,0];
l = 220;w =  180;h1 = 100;
a1 = a + [w/2,l/2,h1];
a2 = a + [w/2,-l/2,h1];
a3 = a + [-w/2,-l/2,h1];
a4 = a + [-w/2,l/2,h1];
syms x y z;
P = [x,y,z];
plane = z - 2700;
syms t;
linea1 = R +t*(a1-R);linea2 = R +t*(a2-R);linea3 = R +t*(a3-R);linea4 = R +t*(a4-R);
funca1 = subs(plane, P, linea1);
funca2 = subs(plane, P, linea2);
funca3 = subs(plane, P, linea3);
funca4 = subs(plane, P, linea4);
ta1 = solve(funca1);ta2 = solve(funca2);ta3 = solve(funca3);ta4 = solve(funca4);
plot3(0,0,0);
Pa1 = subs(linea1,t,ta1);Pa2 = subs(linea2,t,ta2);Pa3 = subs(linea3,t,ta3);Pa4 = subs(linea4,t,ta4);
if (R(1,1)<=a3(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) >= a3(1,2) && R(1,1))
    Pa1 = Pa1 + [10000,10000,0];Pa2 = Pa2 + [10000,-10000,0];Pa3 = Pa3 + [0,-10000,0];Pa4 = Pa4 + [0,10000,0];
end
if (R(1,1)<=a3(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) <= a3(1,2))
   Pa1 = Pa1 + [10000,10000,0];Pa2 = Pa2 + [10000,0,0];Pa4 = Pa4 + [0,10000,0];
end
if (R(1,1)<=a3(1,1)) && (R(1,2)>=a4(1,2)) && (R(1,2) >= a3(1,2))
   Pa1 = Pa1 + [10000,0,0];Pa2 = Pa2 + [10000,-10000,0];Pa3 = Pa3 + [0,-10000,0];
end
if (R(1,1)>a3(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) >= a3(1,2))
    Pa1 = Pa1 + [0,10000,0];Pa2 = Pa2 + [0,-10000,0];Pa3 = Pa3 + [-10000,-10000,0];Pa4 = Pa4 + [-10000,10000,0];
end
if (R(1,1)>a3(1,1)) && (R(1,1)>a2(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) <= a3(1,2))
   Pa1 = Pa1 + [0,10000,0];Pa3 = Pa3 + [-10000,0,0];Pa4 = Pa4 + [10000,10000,0];
end
if (R(1,1)>a3(1,1)) && (R(1,1)>a2(1,1)) && (R(1,2)>=a4(1,2)) && (R(1,2) >= a3(1,2))
   Pa2 = Pa2 + [0,-10000,0];Pa3 = Pa3 + [-10000,-10000,0];Pa4 = Pa4 + [-10000,0,0];
end
if (R(1,1)>a3(1,1)) && (R(1,1)<a2(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) <= a3(1,2))
   Pa1 = Pa1 + [10000,10000,0];Pa2 = Pa2 + [10000,0,0];Pa3 = Pa3 + [-10000,0,0];Pa4 = Pa4 + [-10000,10000,0];
end
if (R(1,1)>a3(1,1)) && (R(1,1)<a2(1,1)) && (R(1,2)>=a4(1,2)) && (R(1,2) >= a3(1,2))
   Pa1 = Pa1 + [10000,0,0];Pa2 = Pa2 + [10000,-10000,0];Pa3 = Pa3 + [-10000,-10000,0];Pa4 = Pa4 + [-10000,0,0];
end

    
X = [ Pa1(1,1)  Pa2(1,1)  Pa3(1,1)   Pa4(1,1)];
Y = [Pa1(1,2) Pa2(1,2) Pa3(1,2) Pa4(1,2)];
Z = [Pa1(1,3) Pa2(1,3) Pa3(1,3) Pa4(1,3)];

patch(X,Y,Z,'red')

hold on

R = [0,0,0];
a = [380,125,0];
l = 220;w =  180;h1 = 300;
a1 = a + [w/2,l/2,h1];
a2 = a + [w/2,-l/2,h1];
a3 = a + [-w/2,-l/2,h1];
a4 = a + [-w/2,l/2,h1];
syms x y z;
P = [x,y,z];
plane = z - 2700;
syms t;
linea1 = R +t*(a1-R);linea2 = R +t*(a2-R);linea3 = R +t*(a3-R);linea4 = R +t*(a4-R);
funca1 = subs(plane, P, linea1);
funca2 = subs(plane, P, linea2);
funca3 = subs(plane, P, linea3);
funca4 = subs(plane, P, linea4);
ta1 = solve(funca1);ta2 = solve(funca2);ta3 = solve(funca3);ta4 = solve(funca4);
plot3(0,0,0);
Pa1 = subs(linea1,t,ta1);Pa2 = subs(linea2,t,ta2);Pa3 = subs(linea3,t,ta3);Pa4 = subs(linea4,t,ta4);
if (R(1,1)<=a3(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) >= a3(1,2) && R(1,1))
    Pa1 = Pa1 + [10000,10000,0];Pa2 = Pa2 + [10000,-10000,0];Pa3 = Pa3 + [0,-10000,0];Pa4 = Pa4 + [0,10000,0];
end
if (R(1,1)<=a3(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) <= a3(1,2))
   Pa1 = Pa1 + [10000,10000,0];Pa2 = Pa2 + [10000,0,0];Pa4 = Pa4 + [0,10000,0];
end
if (R(1,1)<=a3(1,1)) && (R(1,2)>=a4(1,2)) && (R(1,2) >= a3(1,2))
   Pa1 = Pa1 + [10000,0,0];Pa2 = Pa2 + [10000,-10000,0];Pa3 = Pa3 + [0,-10000,0];
end
if (R(1,1)>a3(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) >= a3(1,2))
    Pa1 = Pa1 + [0,10000,0];Pa2 = Pa2 + [0,-10000,0];Pa3 = Pa3 + [-10000,-10000,0];Pa4 = Pa4 + [-10000,10000,0];
end
if (R(1,1)>a3(1,1)) && (R(1,1)>a2(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) <= a3(1,2))
   Pa1 = Pa1 + [0,10000,0];Pa3 = Pa3 + [-10000,0,0];Pa4 = Pa4 + [10000,10000,0];
end
if (R(1,1)>a3(1,1)) && (R(1,1)>a2(1,1)) && (R(1,2)>=a4(1,2)) && (R(1,2) >= a3(1,2))
   Pa2 = Pa2 + [0,-10000,0];Pa3 = Pa3 + [-10000,-10000,0];Pa4 = Pa4 + [-10000,0,0];
end
if (R(1,1)>a3(1,1)) && (R(1,1)<a2(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) <= a3(1,2))
   Pa1 = Pa1 + [10000,10000,0];Pa2 = Pa2 + [10000,0,0];Pa3 = Pa3 + [-10000,0,0];Pa4 = Pa4 + [-10000,10000,0];
end
if (R(1,1)>a3(1,1)) && (R(1,1)<a2(1,1)) && (R(1,2)>=a4(1,2)) && (R(1,2) >= a3(1,2))
   Pa1 = Pa1 + [10000,0,0];Pa2 = Pa2 + [10000,-10000,0];Pa3 = Pa3 + [-10000,-10000,0];Pa4 = Pa4 + [-10000,0,0];
end

X = [ Pa1(1,1)  Pa2(1,1)  Pa3(1,1)   Pa4(1,1)];
Y = [Pa1(1,2) Pa2(1,2) Pa3(1,2) Pa4(1,2)];
Z = [Pa1(1,3) Pa2(1,3) Pa3(1,3) Pa4(1,3)];

patch(X,Y,Z,'red')

hold on

R = [0,0,0];
a = [120,125,0];
l = 220;w =  180;h1 = 200;
a1 = a + [w/2,l/2,h1];
a2 = a + [w/2,-l/2,h1];
a3 = a + [-w/2,-l/2,h1];
a4 = a + [-w/2,l/2,h1];
syms x y z;
P = [x,y,z];
plane = z - 2700;
syms t;
linea1 = R +t*(a1-R);linea2 = R +t*(a2-R);linea3 = R +t*(a3-R);linea4 = R +t*(a4-R);
funca1 = subs(plane, P, linea1);
funca2 = subs(plane, P, linea2);
funca3 = subs(plane, P, linea3);
funca4 = subs(plane, P, linea4);
ta1 = solve(funca1);ta2 = solve(funca2);ta3 = solve(funca3);ta4 = solve(funca4);
plot3(0,0,0);
Pa1 = subs(linea1,t,ta1);Pa2 = subs(linea2,t,ta2);Pa3 = subs(linea3,t,ta3);Pa4 = subs(linea4,t,ta4);
if (R(1,1)<=a3(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) >= a3(1,2) && R(1,1))
    Pa1 = Pa1 + [10000,10000,0];Pa2 = Pa2 + [10000,-10000,0];Pa3 = Pa3 + [0,-10000,0];Pa4 = Pa4 + [0,10000,0];
end
if (R(1,1)<=a3(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) <= a3(1,2))
   Pa1 = Pa1 + [10000,10000,0];Pa2 = Pa2 + [10000,0,0];Pa4 = Pa4 + [0,10000,0];
end
if (R(1,1)<=a3(1,1)) && (R(1,2)>=a4(1,2)) && (R(1,2) >= a3(1,2))
   Pa1 = Pa1 + [10000,0,0];Pa2 = Pa2 + [10000,-10000,0];Pa3 = Pa3 + [0,-10000,0];
end
if (R(1,1)>a3(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) >= a3(1,2))
    Pa1 = Pa1 + [0,10000,0];Pa2 = Pa2 + [0,-10000,0];Pa3 = Pa3 + [-10000,-10000,0];Pa4 = Pa4 + [-10000,10000,0];
end
if (R(1,1)>a3(1,1)) && (R(1,1)>a2(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) <= a3(1,2))
   Pa1 = Pa1 + [0,10000,0];Pa3 = Pa3 + [-10000,0,0];Pa4 = Pa4 + [10000,10000,0];
end
if (R(1,1)>a3(1,1)) && (R(1,1)>a2(1,1)) && (R(1,2)>=a4(1,2)) && (R(1,2) >= a3(1,2))
   Pa2 = Pa2 + [0,-10000,0];Pa3 = Pa3 + [-10000,-10000,0];Pa4 = Pa4 + [-10000,0,0];
end
if (R(1,1)>a3(1,1)) && (R(1,1)<a2(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) <= a3(1,2))
   Pa1 = Pa1 + [10000,10000,0];Pa2 = Pa2 + [10000,0,0];Pa3 = Pa3 + [-10000,0,0];Pa4 = Pa4 + [-10000,10000,0];
end
if (R(1,1)>a3(1,1)) && (R(1,1)<a2(1,1)) && (R(1,2)>=a4(1,2)) && (R(1,2) >= a3(1,2))
   Pa1 = Pa1 + [10000,0,0];Pa2 = Pa2 + [10000,-10000,0];Pa3 = Pa3 + [-10000,-10000,0];Pa4 = Pa4 + [-10000,0,0];
end
    
X = [ Pa1(1,1)  Pa2(1,1)  Pa3(1,1)   Pa4(1,1)];
Y = [Pa1(1,2) Pa2(1,2) Pa3(1,2) Pa4(1,2)];
Z = [Pa1(1,3) Pa2(1,3) Pa3(1,3) Pa4(1,3)];

patch(X,Y,Z,'red')

hold on

R = [0,0,0];
a = [120,375,0];
l = 220;w =  180;h1 = 250;
a1 = a + [w/2,l/2,h1];
a2 = a + [w/2,-l/2,h1];
a3 = a + [-w/2,-l/2,h1];
a4 = a + [-w/2,l/2,h1];
syms x y z;
P = [x,y,z];
plane = z - 2700;
syms t;
linea1 = R +t*(a1-R);linea2 = R +t*(a2-R);linea3 = R +t*(a3-R);linea4 = R +t*(a4-R);
funca1 = subs(plane, P, linea1);
funca2 = subs(plane, P, linea2);
funca3 = subs(plane, P, linea3);
funca4 = subs(plane, P, linea4);
ta1 = solve(funca1);ta2 = solve(funca2);ta3 = solve(funca3);ta4 = solve(funca4);
plot3(0,0,0);
Pa1 = subs(linea1,t,ta1);Pa2 = subs(linea2,t,ta2);Pa3 = subs(linea3,t,ta3);Pa4 = subs(linea4,t,ta4);
if (R(1,1)<=a3(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) >= a3(1,2) && R(1,1))
    Pa1 = Pa1 + [10000,10000,0];Pa2 = Pa2 + [10000,-10000,0];Pa3 = Pa3 + [0,-10000,0];Pa4 = Pa4 + [0,10000,0];
end
if (R(1,1)<=a3(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) <= a3(1,2))
   Pa1 = Pa1 + [10000,10000,0];Pa2 = Pa2 + [10000,0,0];Pa4 = Pa4 + [0,10000,0];
end
if (R(1,1)<=a3(1,1)) && (R(1,2)>=a4(1,2)) && (R(1,2) >= a3(1,2))
   Pa1 = Pa1 + [10000,0,0];Pa2 = Pa2 + [10000,-10000,0];Pa3 = Pa3 + [0,-10000,0];
end
if (R(1,1)>a3(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) >= a3(1,2))
    Pa1 = Pa1 + [0,10000,0];Pa2 = Pa2 + [0,-10000,0];Pa3 = Pa3 + [-10000,-10000,0];Pa4 = Pa4 + [-10000,10000,0];
end
if (R(1,1)>a3(1,1)) && (R(1,1)>a2(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) <= a3(1,2))
   Pa1 = Pa1 + [0,10000,0];Pa3 = Pa3 + [-10000,0,0];Pa4 = Pa4 + [10000,10000,0];
end
if (R(1,1)>a3(1,1)) && (R(1,1)>a2(1,1)) && (R(1,2)>=a4(1,2)) && (R(1,2) >= a3(1,2))
   Pa2 = Pa2 + [0,-10000,0];Pa3 = Pa3 + [-10000,-10000,0];Pa4 = Pa4 + [-10000,0,0];
end
if (R(1,1)>a3(1,1)) && (R(1,1)<a2(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) <= a3(1,2))
   Pa1 = Pa1 + [10000,10000,0];Pa2 = Pa2 + [10000,0,0];Pa3 = Pa3 + [-10000,0,0];Pa4 = Pa4 + [-10000,10000,0];
end
if (R(1,1)>a3(1,1)) && (R(1,1)<a2(1,1)) && (R(1,2)>=a4(1,2)) && (R(1,2) >= a3(1,2))
   Pa1 = Pa1 + [10000,0,0];Pa2 = Pa2 + [10000,-10000,0];Pa3 = Pa3 + [-10000,-10000,0];Pa4 = Pa4 + [-10000,0,0];
end
    
%p1 = [Pa1;Pa2;Pa3;Pa4; Pa1];
%line(p1(:,1), p1(:,2), p1(:,3));
X = [ Pa1(1,1)  Pa2(1,1)  Pa3(1,1)   Pa4(1,1)];
Y = [Pa1(1,2) Pa2(1,2) Pa3(1,2) Pa4(1,2)];
Z = [Pa1(1,3) Pa2(1,3) Pa3(1,3) Pa4(1,3)];

patch(X,Y,Z,'red')

%hold on 
%rectangle(['Position',0,0,500,500]);



