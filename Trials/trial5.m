clc;clear all;
R = [250,250,0];%input('Enter the point on the road: ');
uav_h1 = 500;
uav_h2 = 1500;
uav_s = 1500;
radius = uav_s;center = R + [0,0,uav_s];

theta = linspace(0,2*pi);
phi = linspace(0,pi/2);
[theta,phi] = meshgrid(theta,phi);
[xs,ys,zs] = sph2cart(theta,phi,radius);
[es,fs] = size(zs);
for eo=1:1:es
    for fo =1:1:fs
        col(eo,fo) = 0;
    end
end
%surf(xs,ys,zs,col);

axis([-1500 1500 -1500 1500 0 1500]);
axis('square');
hold on


n = input('Enter number of buildings in urban environment: ');
rotate3d;
for i = 1:1:n;
a = input('Enter centre of building: ');
b = input('Enter [l,w,h] of building: ');
l = b(1,1);w = b(1,2);h1 = b(1,3);
a1 = a + [w/2,l/2,h1];
a2 = a + [w/2,-l/2,h1];
a3 = a + [-w/2,-l/2,h1];
a4 = a + [-w/2,l/2,h1];

syms x y z;
P = [x,y,z];
plane = z - uav_h1;
syms t;
linea1 = R +t*(a1-R);linea2 = R +t*(a2-R);linea3 = R +t*(a3-R);linea4 = R +t*(a4-R);
funca1 = subs(plane, P, linea1);
funca2 = subs(plane, P, linea2);
funca3 = subs(plane, P, linea3);
funca4 = subs(plane, P, linea4);
ta1 = solve(funca1);ta2 = solve(funca2);ta3 = solve(funca3);ta4 = solve(funca4);
plot3(0,0,0);
Pa1 = subs(linea1,t,ta1);Pa2 = subs(linea2,t,ta2);Pa3 = subs(linea3,t,ta3);Pa4 = subs(linea4,t,ta4);
m1 = (Pa1(1,2) - R(1,2))/(Pa1(1,1) - R(1,1));m2 = (Pa2(1,2) - R(1,2))/(Pa2(1,1) - R(1,1));
m3 = (Pa3(1,2) - R(1,2))/(Pa3(1,1) - R(1,1));m4 = (Pa4(1,2) - R(1,2))/(Pa4(1,1) - R(1,1));
%Pa5 = Pa1 + [100000,100000*m1,0];Pa6 = Pa2 + [100000,100000*m2,0];Pa7 = Pa3 + [100000,100000*m3,0];Pa8 = Pa4 + [100000,100000*m4,0];
if (R(1,1)<=a3(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) >= a3(1,2))
    Pa5 = Pa1 + [100000,100000/m1,0];Pa6 = Pa2 + [100000,100000/m2,0];Pa7 = Pa3 + [100000,100000/m3,0];Pa8 = Pa4 + [100000,100000/m4,0];
    X = [Pa5(1,1) Pa6(1,1) Pa7(1,1) Pa3(1,1) Pa4(1,1) Pa8(1,1)];
    Y = [Pa5(1,2) Pa6(1,2) Pa7(1,2) Pa3(1,2) Pa4(1,2) Pa8(1,2)];
    Z = [Pa5(1,3) Pa6(1,3) Pa7(1,3) Pa3(1,3) Pa4(1,3) Pa8(1,3)];
    
    patch(X,Y,Z,'red');

end
if (R(1,1)<=a3(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) <= a3(1,2))
    Pa5 = Pa1 + [100000,100000*m1,0];Pa6 = Pa2 + [100000,100000*m2,0];Pa7 = Pa3 + [100000,100000*m3,0];Pa8 = Pa4 + [100000,100000*m4,0];
    X = [Pa8(1,1) Pa5(1,1) Pa6(1,1) Pa2(1,1) Pa3(1,1) Pa4(1,1)];
    Y = [Pa8(1,2) Pa5(1,2) Pa6(1,2) Pa2(1,2) Pa3(1,2) Pa4(1,2)];
    Z = [Pa8(1,3) Pa5(1,3) Pa6(1,3) Pa2(1,3) Pa3(1,3) Pa4(1,3)];
    
    patch(X,Y,Z,'red');

end
if (R(1,1)<=a3(1,1)) && (R(1,2)>=a4(1,2)) && (R(1,2) >= a3(1,2))
    Pa5 = Pa1 + [100000,100000*m1,0];Pa6 = Pa2 + [100000,100000*m2,0];Pa7 = Pa3 + [100000,100000*m3,0];Pa8 = Pa4 + [100000,100000*m4,0];
    X = [Pa5(1,1) Pa6(1,1) Pa7(1,1) Pa3(1,1) Pa4(1,1) Pa1(1,1)];
    Y = [Pa5(1,2) Pa6(1,2) Pa7(1,2) Pa3(1,2) Pa4(1,2) Pa1(1,2)];
    Z = [Pa5(1,3) Pa6(1,3) Pa7(1,3) Pa3(1,3) Pa4(1,3) Pa1(1,3)];
    
    patch(X,Y,Z,'red');
end
if (R(1,1)>a3(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) >= a3(1,2))
    Pa5 = Pa1 + [-100000,-100000*m1,0];Pa6 = Pa2 + [-100000,-100000*m2,0];Pa7 = Pa3 + [-100000,-100000*m3,0];Pa8 = Pa4 + [-100000,-100000*m4,0];
    X = [Pa1(1,1) Pa2(1,1) Pa6(1,1) Pa7(1,1) Pa8(1,1) Pa5(1,1)];
    Y = [Pa1(1,2) Pa2(1,2) Pa6(1,2) Pa7(1,2) Pa8(1,2) Pa5(1,2)];
    Z = [Pa1(1,3) Pa2(1,3) Pa6(1,3) Pa7(1,3) Pa8(1,3) Pa5(1,3)];
    
    patch(X,Y,Z,'red');
end
if (R(1,1)>a3(1,1)) && (R(1,1)>a2(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) <= a3(1,2))
    Pa5 = Pa1 + [-100000,-100000*m1,0];Pa6 = Pa2 + [-100000,-100000*m2,0];Pa7 = Pa3 + [-100000,-100000*m3,0];Pa8 = Pa4 + [-100000,-100000*m4,0];
    X = [Pa1(1,1) Pa2(1,1) Pa3(1,1) Pa7(1,1) Pa8(1,1) Pa5(1,1)];
    Y = [Pa1(1,2) Pa2(1,2) Pa3(1,2) Pa7(1,2) Pa8(1,2) Pa5(1,2)];
    Z = [Pa1(1,3) Pa2(1,3) Pa3(1,3) Pa7(1,3) Pa8(1,3) Pa5(1,3)];
    
    patch(X,Y,Z,'red');
end
if (R(1,1)>a3(1,1)) && (R(1,1)>a2(1,1)) && (R(1,2)>=a4(1,2)) && (R(1,2) >= a3(1,2))
    Pa5 = Pa1 + [-100000,-100000*m1,0];Pa6 = Pa2 + [-100000,-100000*m2,0];Pa7 = Pa3 + [-100000,-100000*m3,0];Pa8 = Pa4 + [-100000,-100000*m4,0];
    X = [Pa1(1,1) Pa2(1,1) Pa6(1,1) Pa7(1,1) Pa8(1,1) Pa4(1,1)];
    Y = [Pa1(1,2) Pa2(1,2) Pa6(1,2) Pa7(1,2) Pa8(1,2) Pa4(1,2)];
    Z = [Pa1(1,3) Pa2(1,3) Pa6(1,3) Pa7(1,3) Pa8(1,3) Pa4(1,3)];
    
    patch(X,Y,Z,'red');
end
if (R(1,1)>a3(1,1)) && (R(1,1)<a2(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) <= a3(1,2))
    Pa5 = Pa1 + [100000,100000*m1,0];Pa6 = Pa2 + [100000,100000*m2,0];Pa7 = Pa3 + [-100000,-100000*m3,0];Pa8 = Pa4 + [-100000,-100000*m4,0];
    X = [Pa6(1,1) Pa2(1,1) Pa3(1,1) Pa7(1,1) Pa8(1,1) Pa5(1,1)];
    Y = [Pa6(1,2) Pa2(1,2) Pa3(1,2) Pa7(1,2) Pa8(1,2) Pa5(1,2)];
    Z = [Pa6(1,3) Pa2(1,3) Pa3(1,3) Pa7(1,3) Pa8(1,3) Pa5(1,3)];
    
    patch(X,Y,Z,'red');
end
if (R(1,1)>a3(1,1)) && (R(1,1)<a2(1,1)) && (R(1,2)>=a4(1,2)) && (R(1,2) >= a3(1,2))
    Pa5 = Pa1 + [100000,100000*m1,0];Pa6 = Pa2 + [100000,100000*m2,0];Pa7 = Pa3 + [-100000,-100000*m3,0];Pa8 = Pa4 + [-100000,-100000*m4,0];
    X = [Pa1(1,1) Pa5(1,1) Pa6(1,1) Pa7(1,1) Pa8(1,1) Pa4(1,1)];
    Y = [Pa1(1,2) Pa5(1,2) Pa6(1,2) Pa7(1,2) Pa8(1,2) Pa4(1,2)];
    Z = [Pa1(1,3) Pa5(1,3) Pa6(1,3) Pa7(1,3) Pa8(1,3) Pa4(1,3)];
    
    patch(X,Y,Z,'red');
end

syms x y z;
P = [x,y,z];
plane = z - uav_h2;
syms t;
linea1 = R +t*(a1-R);linea2 = R +t*(a2-R);linea3 = R +t*(a3-R);linea4 = R +t*(a4-R);
funca1 = subs(plane, P, linea1);
funca2 = subs(plane, P, linea2);
funca3 = subs(plane, P, linea3);
funca4 = subs(plane, P, linea4);
ta1 = solve(funca1);ta2 = solve(funca2);ta3 = solve(funca3);ta4 = solve(funca4);
plot3(0,0,0);
Qa1 = subs(linea1,t,ta1);Qa2 = subs(linea2,t,ta2);Qa3 = subs(linea3,t,ta3);Qa4 = subs(linea4,t,ta4);
m1 = (Qa1(1,2) - R(1,2))/(Qa1(1,1) - R(1,1));m2 = (Qa2(1,2) - R(1,2))/(Qa2(1,1) - R(1,1));
m3 = (Qa3(1,2) - R(1,2))/(Qa3(1,1) - R(1,1));m4 = (Qa4(1,2) - R(1,2))/(Qa4(1,1) - R(1,1));
%Qa5 = Qa1 + [100000,100000*m1,0];Qa6 = Qa2 + [100000,100000*m2,0];Qa7 = Qa3 + [100000,100000*m3,0];Qa8 = Qa4 + [100000,100000*m4,0];
if (R(1,1)<=a3(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) >= a3(1,2))
    Qa5 = Qa1 + [100000,100000/m1,0];Qa6 = Qa2 + [100000,100000/m2,0];Qa7 = Qa3 + [100000,100000/m3,0];Qa8 = Qa4 + [100000,100000/m4,0];
    X = [Qa5(1,1) Qa6(1,1) Qa7(1,1) Qa3(1,1) Qa4(1,1) Qa8(1,1)];
    Y = [Qa5(1,2) Qa6(1,2) Qa7(1,2) Qa3(1,2) Qa4(1,2) Qa8(1,2)];
    Z = [Qa5(1,3) Qa6(1,3) Qa7(1,3) Qa3(1,3) Qa4(1,3) Qa8(1,3)];
    
    patch(X,Y,Z,'red');
    
X1 = [Pa5(1,1) Pa6(1,1) Qa6(1,1) Qa5(1,1)];
Y1 = [Pa5(1,2) Pa6(1,2) Qa6(1,2) Qa5(1,2)];
Z1 = [Pa5(1,3) Pa6(1,3) Qa6(1,3) Qa5(1,3)];

fill3(X1,Y1,Z1,'red');

X2 = [Pa6(1,1) Pa7(1,1) Qa7(1,1) Qa6(1,1)];
Y2 = [Pa6(1,2) Pa7(1,2) Qa7(1,2) Qa6(1,2)];
Z2 = [Pa6(1,3) Pa7(1,3) Qa7(1,3) Qa6(1,3)];

fill3(X2,Y2,Z2,'red');

X3 = [Pa7(1,1) Pa3(1,1) Qa3(1,1) Qa7(1,1)];
Y3 = [Pa7(1,2) Pa3(1,2) Qa3(1,2) Qa7(1,2)];
Z3 = [Pa7(1,3) Pa3(1,3) Qa3(1,3) Qa7(1,3)];

fill3(X3,Y3,Z3,'red');

X4 = [Pa3(1,1) Pa4(1,1) Qa4(1,1) Qa3(1,1)];
Y4 = [Pa3(1,2) Pa4(1,2) Qa4(1,2) Qa3(1,2)];
Z4 = [Pa3(1,3) Pa4(1,3) Qa4(1,3) Qa3(1,3)];

fill3(X4,Y4,Z4,'red');

X5 = [Pa4(1,1) Pa8(1,1) Qa8(1,1) Qa4(1,1)];
Y5 = [Pa4(1,2) Pa8(1,2) Qa8(1,2) Qa4(1,2)];
Z5 = [Pa4(1,3) Pa8(1,3) Qa8(1,3) Qa4(1,3)];

fill3(X5,Y5,Z5,'red');

X6 = [Pa8(1,1) Pa5(1,1) Qa5(1,1) Qa8(1,1)];
Y6 = [Pa8(1,2) Pa5(1,2) Qa5(1,2) Qa8(1,2)];
Z6 = [Pa8(1,3) Pa5(1,3) Qa5(1,3) Qa8(1,3)];

fill3(X6,Y6,Z6,'red'); 
   
end
if (R(1,1)<=a3(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) <= a3(1,2))
    Qa5 = Qa1 + [100000,100000*m1,0];Qa6 = Qa2 + [100000,100000*m2,0];Qa7 = Qa3 + [100000,100000*m3,0];Qa8 = Qa4 + [100000,100000*m4,0];
    X = [Qa8(1,1) Qa5(1,1) Qa6(1,1) Qa2(1,1) Qa3(1,1) Qa4(1,1)];
    Y = [Qa8(1,2) Qa5(1,2) Qa6(1,2) Qa2(1,2) Qa3(1,2) Qa4(1,2)];
    Z = [Qa8(1,3) Qa5(1,3) Qa6(1,3) Qa2(1,3) Qa3(1,3) Qa4(1,3)];
    
    patch(X,Y,Z,'red');
    

X1 = [Pa8(1,1) Pa5(1,1) Pa5(1,1) Pa8(1,1)];
Y1 = [Pa8(1,2) Pa5(1,2) Pa5(1,2) Pa8(1,2)];
Z1 = [Pa8(1,3) Pa5(1,3) Pa5(1,3) Pa8(1,3)];

fill3(X1,Y1,Z1,'red');

X2 = [Pa5(1,1) Pa6(1,1) Qa6(1,1) Qa5(1,1)];
Y2 = [Pa5(1,2) Pa6(1,2) Qa6(1,2) Qa5(1,2)];
Z2 = [Pa5(1,3) Pa6(1,3) Qa6(1,3) Qa5(1,3)];

fill3(X2,Y2,Z2,'red');

X3 = [Pa6(1,1) Pa2(1,1) Qa2(1,1) Qa6(1,1)];
Y3 = [Pa6(1,2) Pa2(1,2) Qa2(1,2) Qa6(1,2)];
Z3 = [Pa6(1,3) Pa2(1,3) Qa2(1,3) Qa6(1,3)];

fill3(X3,Y3,Z3,'red');

X4 = [Pa2(1,1) Pa3(1,1) Qa3(1,1) Qa2(1,1)];
Y4 = [Pa2(1,2) Pa3(1,2) Qa3(1,2) Qa2(1,2)];
Z4 = [Pa2(1,3) Pa3(1,3) Qa3(1,3) Qa2(1,3)];

fill3(X4,Y4,Z4,'red');

X5 = [Pa3(1,1) Pa4(1,1) Qa4(1,1) Qa3(1,1)];
Y5 = [Pa3(1,2) Pa4(1,2) Qa4(1,2) Qa3(1,2)];
Z5 = [Pa3(1,3) Pa4(1,3) Qa4(1,3) Qa3(1,3)];

fill3(X5,Y5,Z5,'red');

X6 = [Pa4(1,1) Pa8(1,1) Qa8(1,1) Qa4(1,1)];
Y6 = [Pa4(1,2) Pa8(1,2) Qa8(1,2) Qa4(1,2)];
Z6 = [Pa4(1,3) Pa8(1,3) Qa8(1,3) Qa4(1,3)];

fill3(X6,Y6,Z6,'red');    
    

end
if (R(1,1)<=a3(1,1)) && (R(1,2)>=a4(1,2)) && (R(1,2) >= a3(1,2))
    Qa5 = Qa1 + [100000,100000*m1,0];Qa6 = Qa2 + [100000,100000*m2,0];Qa7 = Qa3 + [100000,100000*m3,0];Qa8 = Qa4 + [100000,100000*m4,0];
    X = [Qa5(1,1) Qa6(1,1) Qa7(1,1) Qa3(1,1) Qa4(1,1) Qa1(1,1)];
    Y = [Qa5(1,2) Qa6(1,2) Qa7(1,2) Qa3(1,2) Qa4(1,2) Qa1(1,2)];
    Z = [Qa5(1,3) Qa6(1,3) Qa7(1,3) Qa3(1,3) Qa4(1,3) Qa1(1,3)];
    
    patch(X,Y,Z,'red');
    
X1 = [Pa5(1,1) Pa6(1,1) Pa6(1,1) Pa5(1,1)];
Y1 = [Pa5(1,2) Pa6(1,2) Pa6(1,2) Pa5(1,2)];
Z1 = [Pa5(1,3) Pa6(1,3) Pa6(1,3) Pa5(1,3)];

fill3(X1,Y1,Z1,'red');

X2 = [Pa6(1,1) Pa7(1,1) Qa7(1,1) Qa6(1,1)];
Y2 = [Pa6(1,2) Pa7(1,2) Qa7(1,2) Qa6(1,2)];
Z2 = [Pa6(1,3) Pa7(1,3) Qa7(1,3) Qa6(1,3)];

fill3(X2,Y2,Z2,'red');

X3 = [Pa7(1,1) Pa3(1,1) Qa3(1,1) Qa7(1,1)];
Y3 = [Pa7(1,2) Pa3(1,2) Qa3(1,2) Qa7(1,2)];
Z3 = [Pa7(1,3) Pa3(1,3) Qa3(1,3) Qa7(1,3)];

fill3(X3,Y3,Z3,'red');

X4 = [Pa4(1,1) Pa3(1,1) Qa3(1,1) Qa4(1,1)];
Y4 = [Pa4(1,2) Pa3(1,2) Qa3(1,2) Qa4(1,2)];
Z4 = [Pa4(1,3) Pa3(1,3) Qa3(1,3) Qa4(1,3)];

fill3(X4,Y4,Z4,'red');

X5 = [Pa4(1,1) Pa1(1,1) Qa1(1,1) Qa4(1,1)];
Y5 = [Pa4(1,2) Pa1(1,2) Qa1(1,2) Qa4(1,2)];
Z5 = [Pa4(1,3) Pa1(1,3) Qa1(1,3) Qa4(1,3)];

fill3(X5,Y5,Z5,'red');

X6 = [Pa5(1,1) Pa1(1,1) Qa1(1,1) Qa5(1,1)];
Y6 = [Pa5(1,2) Pa1(1,2) Qa1(1,2) Qa5(1,2)];
Z6 = [Pa5(1,3) Pa1(1,3) Qa1(1,3) Qa5(1,3)];

fill3(X6,Y6,Z6,'red'); 

end
if (R(1,1)>a3(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) >= a3(1,2))
    Qa5 = Qa1 + [-100000,-100000*m1,0];Qa6 = Qa2 + [-100000,-100000*m2,0];Qa7 = Qa3 + [-100000,-100000*m3,0];Qa8 = Qa4 + [-100000,-100000*m4,0];
    X = [Qa1(1,1) Qa2(1,1) Qa6(1,1) Qa7(1,1) Qa8(1,1) Qa5(1,1)];
    Y = [Qa1(1,2) Qa2(1,2) Qa6(1,2) Qa7(1,2) Qa8(1,2) Qa5(1,2)];
    Z = [Qa1(1,3) Qa2(1,3) Qa6(1,3) Qa7(1,3) Qa8(1,3) Qa5(1,3)];
    
    patch(X,Y,Z,'red');
    
X1 = [Pa1(1,1) Pa2(1,1) Pa2(1,1) Pa1(1,1)];
Y1 = [Pa1(1,2) Pa2(1,2) Pa2(1,2) Pa1(1,2)];
Z1 = [Pa1(1,3) Pa2(1,3) Pa2(1,3) Pa1(1,3)];

fill3(X1,Y1,Z1,'red');

X2 = [Pa2(1,1) Pa6(1,1) Qa6(1,1) Qa2(1,1)];
Y2 = [Pa2(1,2) Pa6(1,2) Qa6(1,2) Qa2(1,2)];
Z2 = [Pa2(1,3) Pa6(1,3) Qa6(1,3) Qa2(1,3)];

fill3(X2,Y2,Z2,'red');

X3 = [Pa6(1,1) Pa7(1,1) Qa7(1,1) Qa6(1,1)];
Y3 = [Pa6(1,2) Pa7(1,2) Qa7(1,2) Qa6(1,2)];
Z3 = [Pa6(1,3) Pa7(1,3) Qa7(1,3) Qa6(1,3)];

fill3(X3,Y3,Z3,'red');

X4 = [Pa7(1,1) Pa8(1,1) Qa8(1,1) Qa7(1,1)];
Y4 = [Pa7(1,2) Pa8(1,2) Qa8(1,2) Qa7(1,2)];
Z4 = [Pa7(1,3) Pa8(1,3) Qa8(1,3) Qa7(1,3)];

fill3(X4,Y4,Z4,'red');

X5 = [Pa8(1,1) Pa5(1,1) Qa5(1,1) Qa8(1,1)];
Y5 = [Pa8(1,2) Pa5(1,2) Qa5(1,2) Qa8(1,2)];
Z5 = [Pa8(1,3) Pa5(1,3) Qa5(1,3) Qa8(1,3)];

fill3(X5,Y5,Z5,'red');

X6 = [Pa5(1,1) Pa1(1,1) Qa1(1,1) Qa5(1,1)];
Y6 = [Pa5(1,2) Pa1(1,2) Qa1(1,2) Qa5(1,2)];
Z6 = [Pa5(1,3) Pa1(1,3) Qa1(1,3) Qa5(1,3)];

fill3(X6,Y6,Z6,'red'); 

end
if (R(1,1)>a3(1,1)) && (R(1,1)>a2(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) <= a3(1,2))
    Qa5 = Qa1 + [-100000,-100000*m1,0];Qa6 = Qa2 + [-100000,-100000*m2,0];Qa7 = Qa3 + [-100000,-100000*m3,0];Qa8 = Qa4 + [-100000,-100000*m4,0];
    X = [Qa1(1,1) Qa2(1,1) Qa3(1,1) Qa7(1,1) Qa8(1,1) Qa5(1,1)];
    Y = [Qa1(1,2) Qa2(1,2) Qa3(1,2) Qa7(1,2) Qa8(1,2) Qa5(1,2)];
    Z = [Qa1(1,3) Qa2(1,3) Qa3(1,3) Qa7(1,3) Qa8(1,3) Qa5(1,3)];
    
    patch(X,Y,Z,'red');
    

X1 = [Pa1(1,1) Pa2(1,1) Pa2(1,1) Pa1(1,1)];
Y1 = [Pa1(1,2) Pa2(1,2) Pa2(1,2) Pa1(1,2)];
Z1 = [Pa1(1,3) Pa2(1,3) Pa2(1,3) Pa1(1,3)];

fill3(X1,Y1,Z1,'red');

X2 = [Pa2(1,1) Pa3(1,1) Qa3(1,1) Qa2(1,1)];
Y2 = [Pa2(1,2) Pa3(1,2) Qa3(1,2) Qa2(1,2)];
Z2 = [Pa2(1,3) Pa3(1,3) Qa3(1,3) Qa2(1,3)];

fill3(X2,Y2,Z2,'red');

X3 = [Pa3(1,1) Pa7(1,1) Qa7(1,1) Qa3(1,1)];
Y3 = [Pa3(1,2) Pa7(1,2) Qa7(1,2) Qa3(1,2)];
Z3 = [Pa3(1,3) Pa7(1,3) Qa7(1,3) Qa3(1,3)];

fill3(X3,Y3,Z3,'red');

X4 = [Pa7(1,1) Pa8(1,1) Qa8(1,1) Qa7(1,1)];
Y4 = [Pa7(1,2) Pa8(1,2) Qa8(1,2) Qa7(1,2)];
Z4 = [Pa7(1,3) Pa8(1,3) Qa8(1,3) Qa7(1,3)];

fill3(X4,Y4,Z4,'red');

X5 = [Pa8(1,1) Pa5(1,1) Qa5(1,1) Qa8(1,1)];
Y5 = [Pa8(1,2) Pa5(1,2) Qa5(1,2) Qa8(1,2)];
Z5 = [Pa8(1,3) Pa5(1,3) Qa5(1,3) Qa8(1,3)];

fill3(X5,Y5,Z5,'red');

X6 = [Pa5(1,1) Pa1(1,1) Qa1(1,1) Qa5(1,1)];
Y6 = [Pa5(1,2) Pa1(1,2) Qa1(1,2) Qa5(1,2)];
Z6 = [Pa5(1,3) Pa1(1,3) Qa1(1,3) Qa5(1,3)];

fill3(X6,Y6,Z6,'red');
    
end
if (R(1,1)>a3(1,1)) && (R(1,1)>a2(1,1)) && (R(1,2)>=a4(1,2)) && (R(1,2) >= a3(1,2))
    Qa5 = Qa1 + [-100000,-100000*m1,0];Qa6 = Qa2 + [-100000,-100000*m2,0];Qa7 = Qa3 + [-100000,-100000*m3,0];Qa8 = Qa4 + [-100000,-100000*m4,0];
    X = [Qa1(1,1) Qa2(1,1) Qa6(1,1) Qa7(1,1) Qa8(1,1) Qa4(1,1)];
    Y = [Qa1(1,2) Qa2(1,2) Qa6(1,2) Qa7(1,2) Qa8(1,2) Qa4(1,2)];
    Z = [Qa1(1,3) Qa2(1,3) Qa6(1,3) Qa7(1,3) Qa8(1,3) Qa4(1,3)];
    
    patch(X,Y,Z,'red');
    

X1 = [Pa1(1,1) Pa2(1,1) Pa2(1,1) Pa1(1,1)];
Y1 = [Pa1(1,2) Pa2(1,2) Pa2(1,2) Pa1(1,2)];
Z1 = [Pa1(1,3) Pa2(1,3) Pa2(1,3) Pa1(1,3)];

fill3(X1,Y1,Z1,'red');

X2 = [Pa2(1,1) Pa6(1,1) Qa6(1,1) Qa2(1,1)];
Y2 = [Pa2(1,2) Pa6(1,2) Qa6(1,2) Qa2(1,2)];
Z2 = [Pa2(1,3) Pa6(1,3) Qa6(1,3) Qa2(1,3)];

fill3(X2,Y2,Z2,'red');

X3 = [Pa6(1,1) Pa7(1,1) Qa7(1,1) Qa6(1,1)];
Y3 = [Pa6(1,2) Pa7(1,2) Qa7(1,2) Qa6(1,2)];
Z3 = [Pa6(1,3) Pa7(1,3) Qa7(1,3) Qa6(1,3)];

fill3(X3,Y3,Z3,'red');

X4 = [Pa7(1,1) Pa8(1,1) Qa8(1,1) Qa7(1,1)];
Y4 = [Pa7(1,2) Pa8(1,2) Qa8(1,2) Qa7(1,2)];
Z4 = [Pa7(1,3) Pa8(1,3) Qa8(1,3) Qa7(1,3)];

fill3(X4,Y4,Z4,'red');

X5 = [Pa8(1,1) Pa4(1,1) Qa4(1,1) Qa8(1,1)];
Y5 = [Pa8(1,2) Pa4(1,2) Qa4(1,2) Qa8(1,2)];
Z5 = [Pa8(1,3) Pa4(1,3) Qa4(1,3) Qa8(1,3)];

fill3(X5,Y5,Z5,'red');

X6 = [Pa4(1,1) Pa1(1,1) Qa1(1,1) Qa4(1,1)];
Y6 = [Pa4(1,2) Pa1(1,2) Qa1(1,2) Qa4(1,2)];
Z6 = [Pa4(1,3) Pa1(1,3) Qa1(1,3) Qa4(1,3)];

fill3(X6,Y6,Z6,'red');    
    
end
if (R(1,1)>a3(1,1)) && (R(1,1)<a2(1,1)) && (R(1,2)<=a4(1,2)) && (R(1,2) <= a3(1,2))
    Qa5 = Qa1 + [100000,100000*m1,0];Qa6 = Qa2 + [100000,100000*m2,0];Qa7 = Qa3 + [-100000,-100000*m3,0];Qa8 = Qa4 + [-100000,-100000*m4,0];
    X = [Qa6(1,1) Qa2(1,1) Qa3(1,1) Qa7(1,1) Qa8(1,1) Qa5(1,1)];
    Y = [Qa6(1,2) Qa2(1,2) Qa3(1,2) Qa7(1,2) Qa8(1,2) Qa5(1,2)];
    Z = [Qa6(1,3) Qa2(1,3) Qa3(1,3) Qa7(1,3) Qa8(1,3) Qa5(1,3)];
    
    patch(X,Y,Z,'red');
    

X1 = [Pa6(1,1) Pa2(1,1) Pa2(1,1) Pa6(1,1)];
Y1 = [Pa6(1,2) Pa2(1,2) Pa2(1,2) Pa6(1,2)];
Z1 = [Pa6(1,3) Pa2(1,3) Pa2(1,3) Pa6(1,3)];

fill3(X1,Y1,Z1,'red');

X2 = [Pa2(1,1) Pa3(1,1) Qa3(1,1) Qa2(1,1)];
Y2 = [Pa2(1,2) Pa3(1,2) Qa3(1,2) Qa2(1,2)];
Z2 = [Pa2(1,3) Pa3(1,3) Qa3(1,3) Qa2(1,3)];

fill3(X2,Y2,Z2,'red');

X3 = [Pa3(1,1) Pa7(1,1) Qa7(1,1) Qa3(1,1)];
Y3 = [Pa3(1,2) Pa7(1,2) Qa7(1,2) Qa3(1,2)];
Z3 = [Pa3(1,3) Pa7(1,3) Qa7(1,3) Qa3(1,3)];

fill3(X3,Y3,Z3,'red');

X4 = [Pa7(1,1) Pa8(1,1) Qa8(1,1) Qa7(1,1)];
Y4 = [Pa7(1,2) Pa8(1,2) Qa8(1,2) Qa7(1,2)];
Z4 = [Pa7(1,3) Pa8(1,3) Qa8(1,3) Qa7(1,3)];

fill3(X4,Y4,Z4,'red');

X5 = [Pa8(1,1) Pa5(1,1) Qa5(1,1) Qa8(1,1)];
Y5 = [Pa8(1,2) Pa5(1,2) Qa5(1,2) Qa8(1,2)];
Z5 = [Pa8(1,3) Pa5(1,3) Qa5(1,3) Qa8(1,3)];

fill3(X5,Y5,Z5,'red');

X6 = [Pa5(1,1) Pa6(1,1) Qa6(1,1) Qa5(1,1)];
Y6 = [Pa5(1,2) Pa6(1,2) Qa6(1,2) Qa5(1,2)];
Z6 = [Pa5(1,3) Pa6(1,3) Qa6(1,3) Qa5(1,3)];

fill3(X6,Y6,Z6,'red');    
    
end
if (R(1,1)>a3(1,1)) && (R(1,1)<a2(1,1)) && (R(1,2)>=a4(1,2)) && (R(1,2) >= a3(1,2))
    Qa5 = Qa1 + [100000,100000*m1,0];Qa6 = Qa2 + [100000,100000*m2,0];Qa7 = Qa3 + [-100000,-100000*m3,0];Qa8 = Qa4 + [-100000,-100000*m4,0];
    X = [Qa1(1,1) Qa5(1,1) Qa6(1,1) Qa7(1,1) Qa8(1,1) Qa4(1,1)];
    Y = [Qa1(1,2) Qa5(1,2) Qa6(1,2) Qa7(1,2) Qa8(1,2) Qa4(1,2)];
    Z = [Qa1(1,3) Qa5(1,3) Qa6(1,3) Qa7(1,3) Qa8(1,3) Qa4(1,3)];
    
    patch(X,Y,Z,'red');
    

X1 = [Pa1(1,1) Pa5(1,1) Pa5(1,1) Pa1(1,1)];
Y1 = [Pa1(1,2) Pa5(1,2) Pa5(1,2) Pa1(1,2)];
Z1 = [Pa1(1,3) Pa5(1,3) Pa5(1,3) Pa1(1,3)];

fill3(X1,Y1,Z1,'red');

X2 = [Pa5(1,1) Pa6(1,1) Qa6(1,1) Qa5(1,1)];
Y2 = [Pa5(1,2) Pa6(1,2) Qa6(1,2) Qa5(1,2)];
Z2 = [Pa5(1,3) Pa6(1,3) Qa6(1,3) Qa5(1,3)];

fill3(X2,Y2,Z2,'red');

X3 = [Pa6(1,1) Pa7(1,1) Qa7(1,1) Qa6(1,1)];
Y3 = [Pa6(1,2) Pa7(1,2) Qa7(1,2) Qa6(1,2)];
Z3 = [Pa6(1,3) Pa7(1,3) Qa7(1,3) Qa6(1,3)];

fill3(X3,Y3,Z3,'red');

X4 = [Pa7(1,1) Pa8(1,1) Qa8(1,1) Qa7(1,1)];
Y4 = [Pa7(1,2) Pa8(1,2) Qa8(1,2) Qa7(1,2)];
Z4 = [Pa7(1,3) Pa8(1,3) Qa8(1,3) Qa7(1,3)];

fill3(X4,Y4,Z4,'red');

X5 = [Pa8(1,1) Pa4(1,1) Qa4(1,1) Qa8(1,1)];
Y5 = [Pa8(1,2) Pa4(1,2) Qa4(1,2) Qa8(1,2)];
Z5 = [Pa8(1,3) Pa4(1,3) Qa4(1,3) Qa8(1,3)];

fill3(X5,Y5,Z5,'red');

X6 = [Pa4(1,1) Pa1(1,1) Qa1(1,1) Qa4(1,1)];
Y6 = [Pa4(1,2) Pa1(1,2) Qa1(1,2) Qa4(1,2)];
Z6 = [Pa4(1,3) Pa1(1,3) Qa1(1,3) Qa4(1,3)];

fill3(X6,Y6,Z6,'red');    
    
end




voxel(a + [-w/2,-l/2,0],[w l h1],'c',0.7);

hold on

end




