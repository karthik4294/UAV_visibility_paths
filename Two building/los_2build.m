clc;clear all;close all;
n = 2;% input('Enter number of buildings in urban environment: ');

rotate3d;
h = 400;%input('Enter the height of UAV: ');
const1 = 0;const2 = 1500;
R = [750,750,0];%input('Enter the point on the road: ');


ad = [300,200,180];%input('Enter [l,w,h] of 1st building: ');
bd = [300,200,80];%input('Enter [l,w,h] of 2nd 1building: ');
wr = 50;%input('Enter width of the road: ');

a = [0,750,0];%input('Enter centre of building: ');
b = [0,750,0];
a(1,1) = 750 + (wr/2) + (ad(1,2)/2);
b(1,1) = 750 - (wr/2) - (bd(1,2)/2);

la = ad(1,1);wa = ad(1,2);ha = ad(1,3);

lb = bd(1,1);wb = bd(1,2);hb = bd(1,3);


R(1,2) = 750 - (la/2) + 0.00001;%input('Enter y coordinate of point on road: ');

plot3(R(1,1),R(1,2),0,'-x');

if (R(1,2)<=750+(la/2)) && (R(1,2)>=750-(la/2)) && (R(1,2)<=750+(lb/2)) && (R(1,2)>=750-(lb/2)) 

P1(1,1) = R(1,1) + (wr/2)*((const2 - R(1,2))/(750+(la/2) - R(1,2)));P1(1,2) = const2;

P2(1,1) = R(1,1) + (wr/2)*(h/ha);P2(1,2) = R(1,2) + (750+(la/2)- R(1,2))*(h/ha);

P3(1,1) = R(1,1) + (wr/2)*(h/ha);P3(1,2) = R(1,2) + (750 - (la/2) - R(1,2))*(h/ha);

P4(1,1) = R(1,1) + (wr/2)*((const1 - R(1,2))/(750 -(la/2) - R(1,2)));P4(1,2) = const1;

P5(1,1) = R(1,1) + (-wr/2)*((const1 - R(1,2))/(750 -(lb/2) - R(1,2)));P5(1,2) = const1;

P6(1,1) = R(1,1) + (-wr/2)*(h/hb);P6(1,2) = R(1,2) + (750 -(lb/2) - R(1,2))*(h/hb);

P7(1,1) = R(1,1) + (-wr/2)*(h/hb);P7(1,2) = R(1,2) + (750 +(lb/2) - R(1,2))*(h/hb);

P8(1,1) = R(1,1) + (-wr/2)*((const2 - R(1,2))/(750 +(lb/2) - R(1,2)));P8(1,2) = const2;

X = [P1(1,1) P2(1,1) P3(1,1) P4(1,1) P5(1,1) P6(1,1) P7(1,1) P8(1,1)];
Y = [P1(1,2) P2(1,2) P3(1,2) P4(1,2) P5(1,2) P6(1,2) P7(1,2) P8(1,2)];
Z = [h h h h h h h h];

end


if (R(1,2)<750+(la/2)) && (R(1,2)>750-(la/2)) && (R(1,2)<750+(lb/2)) && (R(1,2)<750-(lb/2))

P1(1,1) = R(1,1) + (wr/2)*((const2 - R(1,2))/(750+(la/2) - R(1,2)));P1(1,2) = const2;

P2(1,1) = R(1,1) + (wr/2)*(h/ha);P2(1,2) = R(1,2) + (750+(la/2)- R(1,2))*(h/ha);

P3(1,1) = R(1,1) + (wr/2)*(h/ha);P3(1,2) = R(1,2) + (750 - (la/2) - R(1,2))*(h/ha);

P4(1,1) = R(1,1) + (wr/2)*((const1 - R(1,2))/(750 -(la/2) - R(1,2)));P4(1,2) = const1;

P5(1,1) = const1;P5(1,2) = R(1,2) + (750 - (lb/2) - R(1,2))*((const1 - R(1,1))/(-wb - (wr/2)));

P6(1,1) = R(1,1) + (-(wr/2)-wb)*(h/hb);P6(1,2) = R(1,2) + (750 - (lb/2) - R(1,2))*(h/hb);

P7(1,1) = R(1,1) + (-wr/2)*(h/hb);P7(1,2) = R(1,2) + (750 - (lb/2) - R(1,2))*(h/hb);

P8(1,1) = R(1,1) + (-wr/2)*(h/hb);P8(1,2) = R(1,2) + (750 +(lb/2) - R(1,2))*(h/hb);

P9(1,1) = R(1,1) + (-wr/2)*((const2 - R(1,2))/(750 +(lb/2) - R(1,2)));P9(1,2) = const2;

X = [P1(1,1) P2(1,1) P3(1,1) P4(1,1) 0 P5(1,1) P6(1,1) P7(1,1) P8(1,1) P9(1,1) ];
Y = [P1(1,2) P2(1,2) P3(1,2) P4(1,2) 0 P5(1,2) P6(1,2) P7(1,2) P8(1,2) P9(1,2) ];
Z = [h h h h h h h h h h];

end


if (R(1,2)<750+(la/2)) && (R(1,2)<750-(la/2)) && (R(1,2)<750+(lb/2)) && (R(1,2)>750-(lb/2)) 

P1(1,1) = R(1,1) + (wr/2)*((const2 - R(1,2))/(750+(la/2) - R(1,2)));P1(1,2) = const2;

P2(1,1) = R(1,1) + (wr/2)*(h/ha);P2(1,2) = R(1,2) + (750+(la/2)- R(1,2))*(h/ha);

P3(1,1) = R(1,1) + (wr/2)*(h/ha);P3(1,2) = R(1,2) + (750 - (la/2) - R(1,2))*(h/ha);

P4(1,1) = R(1,1) + ((wr/2) + wa)*(h/ha);P4(1,2) = R(1,2) + (750 - (la/2) - R(1,2))*(h/ha);

P5(1,1) = const2;P5(1,2) = R(1,2) + (750 - (la/2) - R(1,2))*((const2 - R(1,1))/((wr/2) + wa));

P6(1,1) = R(1,1) + (-wr/2)*((const1 - R(1,2))/(750 -(lb/2) - R(1,2)));P6(1,2) = const1;

P7(1,1) = R(1,1) + (-wr/2)*(h/hb);P7(1,2) = R(1,2) + (750 -(lb/2) - R(1,2))*(h/hb);

P8(1,1) = R(1,1) + (-wr/2)*(h/hb);P8(1,2) = R(1,2) + (750 +(lb/2) - R(1,2))*(h/hb);

P9(1,1) = R(1,1) + (-wr/2)*((const2 - R(1,2))/(750 +(lb/2) - R(1,2)));P9(1,2) = const2;

X = [P1(1,1) P2(1,1) P3(1,1) P4(1,1) P5(1,1) 1500 P6(1,1) P7(1,1) P8(1,1) P9(1,1) ];
Y = [P1(1,2) P2(1,2) P3(1,2) P4(1,2) P5(1,2)  0 P6(1,2) P7(1,2) P8(1,2) P9(1,2) ];
Z = [h h h h h h h h h h];

end


if (R(1,2)<750+(la/2)) && (R(1,2)<750-(la/2)) && (R(1,2)<750+(lb/2)) && (R(1,2)<750-(lb/2)) 

P1(1,1) = R(1,1) + (wr/2)*((const2 - R(1,2))/(750+(la/2) - R(1,2)));P1(1,2) = const2;

P2(1,1) = R(1,1) + (wr/2)*(h/ha);P2(1,2) = R(1,2) + (750+(la/2)- R(1,2))*(h/ha);

P3(1,1) = R(1,1) + (wr/2)*(h/ha);P3(1,2) = R(1,2) + (750 - (la/2) - R(1,2))*(h/ha);

P4(1,1) = R(1,1) + ((wr/2) + wa)*(h/ha);P4(1,2) = R(1,2) + (750 - (la/2) - R(1,2))*(h/ha);

P5(1,1) = const2;P5(1,2) = R(1,2) + (750 - (la/2) - R(1,2))*((const2 - R(1,1))/((wr/2) + wa ));

P6(1,1) = const1;P6(1,2) = R(1,2) + (750 - (lb/2) - R(1,2))*((const1 - R(1,1))/(-wb - (wr/2)));

P7(1,1) = R(1,1) + (-(wr/2)-wb)*(h/hb);P7(1,2) = R(1,2) + (750 - (lb/2) - R(1,2))*(h/hb);

P8(1,1) = R(1,1) + (-wr/2)*(h/hb);P8(1,2) = R(1,2) + (750 - (lb/2) - R(1,2))*(h/hb);

P9(1,1) = R(1,1) + (-wr/2)*(h/hb);P9(1,2) = R(1,2) + (750 +(lb/2) - R(1,2))*(h/hb);

P10(1,1) = R(1,1) + (-wr/2)*((const2 - R(1,2))/(750 +(lb/2) - R(1,2)));P10(1,2) = const2;

X = [P1(1,1) P2(1,1) P3(1,1) P4(1,1) P5(1,1) 1500 0 P6(1,1) P7(1,1) P8(1,1) P9(1,1) P10(1,1)];
Y = [P1(1,2) P2(1,2) P3(1,2) P4(1,2) P5(1,2) 0 0 P6(1,2) P7(1,2) P8(1,2) P9(1,2) P10(1,2)];
Z = [h h h h h h h h h h h h];

end


if (R(1,2)<750+(la/2)) && (R(1,2)>750-(la/2)) && (R(1,2)>750+(lb/2)) && (R(1,2)>750-(lb/2)) 

P1(1,1) = R(1,1) + (wr/2)*((const2 - R(1,2))/(750+(la/2) - R(1,2)));P1(1,2) = const2;

P2(1,1) = R(1,1) + (wr/2)*(h/ha);P2(1,2) = R(1,2) + (750+(la/2)- R(1,2))*(h/ha);

P3(1,1) = R(1,1) + (wr/2)*(h/ha);P3(1,2) = R(1,2) + (750 - (la/2) - R(1,2))*(h/ha);

P4(1,1) = R(1,1) + (wr/2)*((const1 - R(1,2))/(750 -(la/2) - R(1,2)));P4(1,2) = const1;

P5(1,1) = R(1,1) + (-wr/2)*((const1 - R(1,2))/(750 -(lb/2) - R(1,2)));P5(1,2) = const1;

P6(1,1) = R(1,1) + (-wr/2)*(h/hb);P6(1,2) = R(1,2) + (750 -(lb/2) - R(1,2))*(h/hb);

P7(1,1) = R(1,1) + (-wr/2)*(h/hb);P7(1,2) = R(1,2) + (750 +(lb/2) - R(1,2))*(h/hb);

P8(1,1) = R(1,1) + (-(wr/2) - wb)*(h/hb);P8(1,2) = R(1,2) + (750 +(lb/2) - R(1,2))*(h/hb);

P9(1,1) = const1;P9(1,2) = R(1,2) + (750 +(lb/2) - R(1,2))*((const1 - R(1,1))/(-(wr/2) - wb));

X = [P1(1,1) P2(1,1) P3(1,1) P4(1,1) P5(1,1) P6(1,1) P7(1,1) P8(1,1) P9(1,1) 0];
Y = [P1(1,2) P2(1,2) P3(1,2) P4(1,2) P5(1,2) P6(1,2) P7(1,2) P8(1,2) P9(1,2) 1500];
Z = [h h h h h h h h h h ];

end


if (R(1,2)>750+(la/2)) && (R(1,2)>750-(la/2)) && (R(1,2)<750+(lb/2)) && (R(1,2)>750-(lb/2)) 

P1(1,1) = const2;P1(1,2) = R(1,1) + (750+(la/2) - R(1,2))*((const2 - R(1,1))/((wr/2) + wa));

P2(1,1) = R(1,1) + ((wr/2)+ wa)*(h/ha);P2(1,2) = R(1,2) + (750+(la/2)- R(1,2))*(h/ha);

P3(1,1) = R(1,1) + (wr/2)*(h/ha);P3(1,2) = R(1,2) + (750+(la/2)- R(1,2))*(h/ha);

P4(1,1) = R(1,1) + (wr/2)*(h/ha);P4(1,2) = R(1,2) + (750 - (la/2) - R(1,2))*(h/ha);

P5(1,1) = R(1,1) + (wr/2)*((const1 - R(1,2))/(750 -(la/2) - R(1,2)));P5(1,2) = const1;

P6(1,1) = R(1,1) + (-wr/2)*((const1 - R(1,2))/(750 -(lb/2) - R(1,2)));P6(1,2) = const1;

P7(1,1) = R(1,1) + (-wr/2)*(h/hb);P7(1,2) = R(1,2) + (750 -(lb/2) - R(1,2))*(h/hb);

P8(1,1) = R(1,1) + (-wr/2)*(h/hb);P8(1,2) = R(1,2) + (750 +(lb/2) - R(1,2))*(h/hb);

P9(1,1) = R(1,1) + (-wr/2)*((const2 - R(1,2))/(750 +(lb/2) - R(1,2)));P9(1,2) = const2;

X = [1500 P1(1,1) P2(1,1) P3(1,1) P4(1,1) P5(1,1) P6(1,1) P7(1,1) P8(1,1) P9(1,1)];
Y = [1500 P1(1,2) P2(1,2) P3(1,2) P4(1,2) P5(1,2) P6(1,2) P7(1,2) P8(1,2) P9(1,2)];
Z = [h h h h h h h h h h];

end


if (R(1,2)>750+(la/2)) && (R(1,2)>750-(la/2)) && (R(1,2)>750+(lb/2)) && (R(1,2)>750-(lb/2)) 

P1(1,1) = const2;P1(1,2) = R(1,2) + (750+(la/2) - R(1,2))*((const2 - R(1,1))/((wr/2) + wa));

P2(1,1) = R(1,1) + ((wr/2)+ wa)*(h/ha);P2(1,2) = R(1,2) + (750+(la/2)- R(1,2))*(h/ha);

P3(1,1) = R(1,1) + (wr/2)*(h/ha);P3(1,2) = R(1,2) + (750+(la/2)- R(1,2))*(h/ha);

P4(1,1) = R(1,1) + (wr/2)*(h/ha);P4(1,2) = R(1,2) + (750 - (la/2) - R(1,2))*(h/ha);

P5(1,1) = R(1,1) + (wr/2)*((const1 - R(1,2))/(750 -(la/2) - R(1,2)));P5(1,2) = const1;

P6(1,1) = R(1,1) + (-wr/2)*((const1 - R(1,2))/(750 -(lb/2) - R(1,2)));P6(1,2) = const1;

P7(1,1) = R(1,1) + (-wr/2)*(h/hb);P7(1,2) = R(1,2) + (750 -(lb/2) - R(1,2))*(h/hb);

P8(1,1) = R(1,1) + (-(wr/2) - wb)*(h/hb);P8(1,2) = R(1,2) + (750 -(lb/2) - R(1,2))*(h/hb);

P9(1,1) = R(1,1) + (-(wr/2) - wb)*(h/hb);P9(1,2) = R(1,2) + (750 +(lb/2) - R(1,2))*(h/hb);

P10(1,1) = const1;P10(1,2) = R(1,2) + (750 +(lb/2) - R(1,2))*((const1 - R(1,1))/(-(wr/2) - wb));

X = [1500 P1(1,1) P2(1,1) P3(1,1) P4(1,1) P5(1,1) P6(1,1) P7(1,1) P8(1,1) P9(1,1) P10(1,1) 0];
Y = [1500 P1(1,2) P2(1,2) P3(1,2) P4(1,2) P5(1,2) P6(1,2) P7(1,2) P8(1,2) P9(1,2) P10(1,2) 1500];
Z = [h h h h h h h h h h h h];

end


R(1,2) = 750 + (la/2) - 0.00001;

hold on 

plot3(R(1,1),R(1,2),0,'-x');

if (R(1,2)<=750+(la/2)) && (R(1,2)>=750-(la/2)) && (R(1,2)<=750+(lb/2)) && (R(1,2)>=750-(lb/2)) 

P1(1,1) = R(1,1) + (wr/2)*((const2 - R(1,2))/(750+(la/2) - R(1,2)));P1(1,2) = const2;

P2(1,1) = R(1,1) + (wr/2)*(h/ha);P2(1,2) = R(1,2) + (750+(la/2)- R(1,2))*(h/ha);

P3(1,1) = R(1,1) + (wr/2)*(h/ha);P3(1,2) = R(1,2) + (750 - (la/2) - R(1,2))*(h/ha);

P4(1,1) = R(1,1) + (wr/2)*((const1 - R(1,2))/(750 -(la/2) - R(1,2)));P4(1,2) = const1;

P5(1,1) = R(1,1) + (-wr/2)*((const1 - R(1,2))/(750 -(lb/2) - R(1,2)));P5(1,2) = const1;

P6(1,1) = R(1,1) + (-wr/2)*(h/hb);P6(1,2) = R(1,2) + (750 -(lb/2) - R(1,2))*(h/hb);

P7(1,1) = R(1,1) + (-wr/2)*(h/hb);P7(1,2) = R(1,2) + (750 +(lb/2) - R(1,2))*(h/hb);

P8(1,1) = R(1,1) + (-wr/2)*((const2 - R(1,2))/(750 +(lb/2) - R(1,2)));P8(1,2) = const2;

X1 = [P1(1,1) P2(1,1) P3(1,1) P4(1,1) P5(1,1) P6(1,1) P7(1,1) P8(1,1)];
Y1 = [P1(1,2) P2(1,2) P3(1,2) P4(1,2) P5(1,2) P6(1,2) P7(1,2) P8(1,2)];
Z1 = [h h h h h h h h];

end


if (R(1,2)<750+(la/2)) && (R(1,2)>750-(la/2)) && (R(1,2)<750+(lb/2)) && (R(1,2)<750-(lb/2))

P1(1,1) = R(1,1) + (wr/2)*((const2 - R(1,2))/(750+(la/2) - R(1,2)));P1(1,2) = const2;

P2(1,1) = R(1,1) + (wr/2)*(h/ha);P2(1,2) = R(1,2) + (750+(la/2)- R(1,2))*(h/ha);

P3(1,1) = R(1,1) + (wr/2)*(h/ha);P3(1,2) = R(1,2) + (750 - (la/2) - R(1,2))*(h/ha);

P4(1,1) = R(1,1) + (wr/2)*((const1 - R(1,2))/(750 -(la/2) - R(1,2)));P4(1,2) = const1;

P5(1,1) = const1;P5(1,2) = R(1,2) + (750 - (lb/2) - R(1,2))*((const1 - R(1,1))/(-wb - (wr/2)));

P6(1,1) = R(1,1) + (-(wr/2)-wb)*(h/hb);P6(1,2) = R(1,2) + (750 - (lb/2) - R(1,2))*(h/hb);

P7(1,1) = R(1,1) + (-wr/2)*(h/hb);P7(1,2) = R(1,2) + (750 - (lb/2) - R(1,2))*(h/hb);

P8(1,1) = R(1,1) + (-wr/2)*(h/hb);P8(1,2) = R(1,2) + (750 +(lb/2) - R(1,2))*(h/hb);

P9(1,1) = R(1,1) + (-wr/2)*((const2 - R(1,2))/(750 +(lb/2) - R(1,2)));P9(1,2) = const2;

X1 = [P1(1,1) P2(1,1) P3(1,1) P4(1,1) 0 P5(1,1) P6(1,1) P7(1,1) P8(1,1) P9(1,1) ];
Y1 = [P1(1,2) P2(1,2) P3(1,2) P4(1,2) 0 P5(1,2) P6(1,2) P7(1,2) P8(1,2) P9(1,2) ];
Z1 = [h h h h h h h h h h];

end


if (R(1,2)<750+(la/2)) && (R(1,2)<750-(la/2)) && (R(1,2)<750+(lb/2)) && (R(1,2)>750-(lb/2)) 

P1(1,1) = R(1,1) + (wr/2)*((const2 - R(1,2))/(750+(la/2) - R(1,2)));P1(1,2) = const2;

P2(1,1) = R(1,1) + (wr/2)*(h/ha);P2(1,2) = R(1,2) + (750+(la/2)- R(1,2))*(h/ha);

P3(1,1) = R(1,1) + (wr/2)*(h/ha);P3(1,2) = R(1,2) + (750 - (la/2) - R(1,2))*(h/ha);

P4(1,1) = R(1,1) + ((wr/2) + wa)*(h/ha);P4(1,2) = R(1,2) + (750 - (la/2) - R(1,2))*(h/ha);

P5(1,1) = const2;P5(1,2) = R(1,2) + (750 - (la/2) - R(1,2))*((const2 - R(1,1))/((wr/2) + wa));

P6(1,1) = R(1,1) + (-wr/2)*((const1 - R(1,2))/(750 -(lb/2) - R(1,2)));P6(1,2) = const1;

P7(1,1) = R(1,1) + (-wr/2)*(h/hb);P7(1,2) = R(1,2) + (750 -(lb/2) - R(1,2))*(h/hb);

P8(1,1) = R(1,1) + (-wr/2)*(h/hb);P8(1,2) = R(1,2) + (750 +(lb/2) - R(1,2))*(h/hb);

P9(1,1) = R(1,1) + (-wr/2)*((const2 - R(1,2))/(750 +(lb/2) - R(1,2)));P9(1,2) = const2;

X1 = [P1(1,1) P2(1,1) P3(1,1) P4(1,1) P5(1,1) 1500 P6(1,1) P7(1,1) P8(1,1) P9(1,1) ];
Y1 = [P1(1,2) P2(1,2) P3(1,2) P4(1,2) P5(1,2)  0 P6(1,2) P7(1,2) P8(1,2) P9(1,2) ];
Z1 = [h h h h h h h h h h];

end


if (R(1,2)<750+(la/2)) && (R(1,2)<750-(la/2)) && (R(1,2)<750+(lb/2)) && (R(1,2)<750-(lb/2)) 

P1(1,1) = R(1,1) + (wr/2)*((const2 - R(1,2))/(750+(la/2) - R(1,2)));P1(1,2) = const2;

P2(1,1) = R(1,1) + (wr/2)*(h/ha);P2(1,2) = R(1,2) + (750+(la/2)- R(1,2))*(h/ha);

P3(1,1) = R(1,1) + (wr/2)*(h/ha);P3(1,2) = R(1,2) + (750 - (la/2) - R(1,2))*(h/ha);

P4(1,1) = R(1,1) + ((wr/2) + wa)*(h/ha);P4(1,2) = R(1,2) + (750 - (la/2) - R(1,2))*(h/ha);

P5(1,1) = const2;P5(1,2) = R(1,2) + (750 - (la/2) - R(1,2))*((const2 - R(1,1))/((wr/2) + wa ));

P6(1,1) = const1;P6(1,2) = R(1,2) + (750 - (lb/2) - R(1,2))*((const1 - R(1,1))/(-wb - (wr/2)));

P7(1,1) = R(1,1) + (-(wr/2)-wb)*(h/hb);P7(1,2) = R(1,2) + (750 - (lb/2) - R(1,2))*(h/hb);

P8(1,1) = R(1,1) + (-wr/2)*(h/hb);P8(1,2) = R(1,2) + (750 - (lb/2) - R(1,2))*(h/hb);

P9(1,1) = R(1,1) + (-wr/2)*(h/hb);P9(1,2) = R(1,2) + (750 +(lb/2) - R(1,2))*(h/hb);

P10(1,1) = R(1,1) + (-wr/2)*((const2 - R(1,2))/(750 +(lb/2) - R(1,2)));P10(1,2) = const2;

X1 = [P1(1,1) P2(1,1) P3(1,1) P4(1,1) P5(1,1) 1500 0 P6(1,1) P7(1,1) P8(1,1) P9(1,1) P10(1,1)];
Y1 = [P1(1,2) P2(1,2) P3(1,2) P4(1,2) P5(1,2) 0 0 P6(1,2) P7(1,2) P8(1,2) P9(1,2) P10(1,2)];
Z1 = [h h h h h h h h h h h h];

end


if (R(1,2)<750+(la/2)) && (R(1,2)>750-(la/2)) && (R(1,2)>750+(lb/2)) && (R(1,2)>750-(lb/2)) 

P1(1,1) = R(1,1) + (wr/2)*((const2 - R(1,2))/(750+(la/2) - R(1,2)));P1(1,2) = const2;

P2(1,1) = R(1,1) + (wr/2)*(h/ha);P2(1,2) = R(1,2) + (750+(la/2)- R(1,2))*(h/ha);

P3(1,1) = R(1,1) + (wr/2)*(h/ha);P3(1,2) = R(1,2) + (750 - (la/2) - R(1,2))*(h/ha);

P4(1,1) = R(1,1) + (wr/2)*((const1 - R(1,2))/(750 -(la/2) - R(1,2)));P4(1,2) = const1;

P5(1,1) = R(1,1) + (-wr/2)*((const1 - R(1,2))/(750 -(lb/2) - R(1,2)));P5(1,2) = const1;

P6(1,1) = R(1,1) + (-wr/2)*(h/hb);P6(1,2) = R(1,2) + (750 -(lb/2) - R(1,2))*(h/hb);

P7(1,1) = R(1,1) + (-wr/2)*(h/hb);P7(1,2) = R(1,2) + (750 +(lb/2) - R(1,2))*(h/hb);

P8(1,1) = R(1,1) + (-(wr/2) - wb)*(h/hb);P8(1,2) = R(1,2) + (750 +(lb/2) - R(1,2))*(h/hb);

P9(1,1) = const1;P9(1,2) = R(1,2) + (750 +(lb/2) - R(1,2))*((const1 - R(1,1))/(-(wr/2) - wb));

X1 = [P1(1,1) P2(1,1) P3(1,1) P4(1,1) P5(1,1) P6(1,1) P7(1,1) P8(1,1) P9(1,1) 0];
Y1 = [P1(1,2) P2(1,2) P3(1,2) P4(1,2) P5(1,2) P6(1,2) P7(1,2) P8(1,2) P9(1,2) 1500];
Z1 = [h h h h h h h h h h ];

end


if (R(1,2)>750+(la/2)) && (R(1,2)>750-(la/2)) && (R(1,2)<750+(lb/2)) && (R(1,2)>750-(lb/2)) 

P1(1,1) = const2;P1(1,2) = R(1,1) + (750+(la/2) - R(1,2))*((const2 - R(1,1))/((wr/2) + wa));

P2(1,1) = R(1,1) + ((wr/2)+ wa)*(h/ha);P2(1,2) = R(1,2) + (750+(la/2)- R(1,2))*(h/ha);

P3(1,1) = R(1,1) + (wr/2)*(h/ha);P3(1,2) = R(1,2) + (750+(la/2)- R(1,2))*(h/ha);

P4(1,1) = R(1,1) + (wr/2)*(h/ha);P4(1,2) = R(1,2) + (750 - (la/2) - R(1,2))*(h/ha);

P5(1,1) = R(1,1) + (wr/2)*((const1 - R(1,2))/(750 -(la/2) - R(1,2)));P5(1,2) = const1;

P6(1,1) = R(1,1) + (-wr/2)*((const1 - R(1,2))/(750 -(lb/2) - R(1,2)));P6(1,2) = const1;

P7(1,1) = R(1,1) + (-wr/2)*(h/hb);P7(1,2) = R(1,2) + (750 -(lb/2) - R(1,2))*(h/hb);

P8(1,1) = R(1,1) + (-wr/2)*(h/hb);P8(1,2) = R(1,2) + (750 +(lb/2) - R(1,2))*(h/hb);

P9(1,1) = R(1,1) + (-wr/2)*((const2 - R(1,2))/(750 +(lb/2) - R(1,2)));P9(1,2) = const2;

X1 = [1500 P1(1,1) P2(1,1) P3(1,1) P4(1,1) P5(1,1) P6(1,1) P7(1,1) P8(1,1) P9(1,1)];
Y1 = [1500 P1(1,2) P2(1,2) P3(1,2) P4(1,2) P5(1,2) P6(1,2) P7(1,2) P8(1,2) P9(1,2)];
Z1 = [h h h h h h h h h h];

end


if (R(1,2)>750+(la/2)) && (R(1,2)>750-(la/2)) && (R(1,2)>750+(lb/2)) && (R(1,2)>750-(lb/2)) 

P1(1,1) = const2;P1(1,2) = R(1,2) + (750+(la/2) - R(1,2))*((const2 - R(1,1))/((wr/2) + wa));

P2(1,1) = R(1,1) + ((wr/2)+ wa)*(h/ha);P2(1,2) = R(1,2) + (750+(la/2)- R(1,2))*(h/ha);

P3(1,1) = R(1,1) + (wr/2)*(h/ha);P3(1,2) = R(1,2) + (750+(la/2)- R(1,2))*(h/ha);

P4(1,1) = R(1,1) + (wr/2)*(h/ha);P4(1,2) = R(1,2) + (750 - (la/2) - R(1,2))*(h/ha);

P5(1,1) = R(1,1) + (wr/2)*((const1 - R(1,2))/(750 -(la/2) - R(1,2)));P5(1,2) = const1;

P6(1,1) = R(1,1) + (-wr/2)*((const1 - R(1,2))/(750 -(lb/2) - R(1,2)));P6(1,2) = const1;

P7(1,1) = R(1,1) + (-wr/2)*(h/hb);P7(1,2) = R(1,2) + (750 -(lb/2) - R(1,2))*(h/hb);

P8(1,1) = R(1,1) + (-(wr/2) - wb)*(h/hb);P8(1,2) = R(1,2) + (750 -(lb/2) - R(1,2))*(h/hb);

P9(1,1) = R(1,1) + (-(wr/2) - wb)*(h/hb);P9(1,2) = R(1,2) + (750 +(lb/2) - R(1,2))*(h/hb);

P10(1,1) = const1;P10(1,2) = R(1,2) + (750 +(lb/2) - R(1,2))*((const1 - R(1,1))/(-(wr/2) - wb));

X1 = [1500 P1(1,1) P2(1,1) P3(1,1) P4(1,1) P5(1,1) P6(1,1) P7(1,1) P8(1,1) P9(1,1) P10(1,1) 0];
Y1 = [1500 P1(1,2) P2(1,2) P3(1,2) P4(1,2) P5(1,2) P6(1,2) P7(1,2) P8(1,2) P9(1,2) P10(1,2) 1500];
Z1 = [h h h h h h h h h h h h];

end



[Xb, Yb] = polybool('intersection', X,Y,X1,Y1);

num = numel(Xb);
for po=1:1:num;
    Zb(po,1) = h;
end


patch(Xb,Yb,Zb,'green');

voxel(a + [-wa/2,-la/2,0],[wa la ha],'c',0.7);
voxel(b + [-wb/2,-lb/2,0],[wb lb hb],'c',0.7);

axis([const1 const2 const1 const2 0 h]);
axis('square');


hold on 

global k vt va r U TIME 
 
k = 5;
vt = 7;
va = 20;
r=  0.8;
U = [];
TIME = [];

Wi = [750,150];Wf = [750,1500];


x_t_0 = Wi(1,1);
y_t_0 = Wi(1,2);
chi_t_0 = pi/2;

x_a_0 = 750;
y_a_0 = 150;
chi_a_0 = pi/6;


tspan = [0,150];
z0 = [x_t_0;y_t_0;chi_t_0;x_a_0;y_a_0;chi_a_0;];
options = odeset ('reltol',1e-10,'abstol',1e-10);
[t,z] = ode45('los',tspan,z0,options);



x_t = z(:,1);y_t = z(:,2);

x_a = z(:,4);y_a = z(:,5);

chi_t = z(:,3);chi_a = z(:,6);

len1 = length(x_t);
for check = 1:1:len1
    h_t(check,1) = 0;
    h_uav(check,1) = h;
end



figure(1)
hold on
plot3(x_t,y_t,h_t,'color','b');
hold on 
plot3(x_a,y_a,h_uav,'color','r');


figure(2)
hold on
patch(Xb,Yb,'green');
hold on
plot(x_t,y_t,'color','b');
hold on 
plot(x_a,y_a,'color','r');

figure(3)
hold on
plot(TIME,U,'r');
axis equal;

chi_r = chi_a*180/pi;
%figure(3)
%plot(t,chi_r);



%axis([-100 200 -100 200]);
axis('square');


